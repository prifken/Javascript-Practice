<!DOCTYPE html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<title>High contrast theme - Black</title>
</head>
	<script src="https://team.quickbase.com/db/bmfirusgi?a=pagePreview&pageID=35" type="text/javascript" charset="utf-8"></script> <!--../../codebase/dhtmlxgantt.js-->
	<script src="https://team.quickbase.com/db/bmfirusgi?a=pagePreview&pageID=36" type="text/javascript" charset="utf-8"></script> <!--../../codebase/ext/dhtmlxgantt_quick_info.js-->
	<script src="https://team.quickbase.com/db/bmfirusgi?a=pagePreview&pageID=37" type="text/javascript" charset="utf-8"></script> <!--../../codebase/ext/dhtmlxgantt_tooltip.js --> 
	<link rel="stylesheet" href="https://team.quickbase.com/db/bmfirusgi?a=pagePreview&pageID=40" type="text/css" media="screen" title="no title" charset="utf-8"> <!--../../codebase/skins/dhtmlxgantt_contrast_default.css-->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
	<script type="text/javascript" src="https://team.quickbase.com/db/bmfirusgi?a=pagePreview&pageID=39"></script><!--../common/testdata.js-->
	<script>
	function gettaskarray(RID){
		var url = "https://team.quickbase.com/db/bmfirusyr/?a=API_DoQuery&query={'48'.EX.'"+RID+"'}";     // Remember to put in YOUR baseURL
		
		  var request = "<qdbapi>";
		  request    += "<usertoken>b287yg_uyp_dsagzw8b755gx7bvr8hfmdp3fu53</usertoken>";            // Remember to put in YOUR appToken
		  request    += "</qdbapi>";
		//console.log("Entered task array function, RID= "+RID); 
		$.ajax({
		type: "POST",
		contentType: "text/xml",
		async: false,
		url: url,
		dataType: "xml",
		processData: false,
		data: request,
		          success: function (response) {
		
		           var xml = $(response); //Convert response to XML Code
		           if (xml.find('qdbapi').find('errcode').text() == "0") {
		        
		         // console.log(response); 
		      //Looping Through Response Begins Below
		                       xml.find('qdbapi').find('record').each(function(index){  
		                        var x = new tasks(0,"Name","Status","StartDate","EndDate",0,0,0); 
		                        x.taskID=$(this).find("task_id").text();
		                        x.taskName=$(this).find("task_name").text();
		                        x.taskStatus=$(this).find("status").text();
		                        x.taskStartDate=new Date(parseInt($(this).find("start").text()));
		                        x.taskEndDate=new Date(parseInt($(this).find("projected_finish").text()));
		                        x.taskDuration=1; 
		                        x.taskPercentComplete=parseInt(($(this).find("___complete").text()*100));
		                        //alert(x.taskPercentComplete);
		                        x.taskPredID=$(this).find("predecessors").text();; /*$(this).find("predecessors").text();*/
		                        x.taskRelProject=$(this).find("related_project").text();
		                        //console.log(x); 
		
		                      //console.log(x); 
		                        gantt.addTask({
		   						 id:RID+"_"+x.taskID,
		   						 text:x.taskName,
		   						 start_date:x.taskStartDate, 
		   						 duration: x.taskDuration
								}, RID, 1);
								console.log(RID+"_"+x.taskID);
		                      //console.log("\n\n");
		                    });//End XML Loop
		        //console.log(coachArray);
		        }
		          else 
		          {
		           console.log("Quickbase returned an error.");
		           console.log(response);
		         } 
		       },
		error: function (response)
		  {
		  console.log("Quickbase returned an error.");
		  console.log(response);
		  }
		});
		
		}
    /*
	gantt.attachEvent("onLightboxSave", function(id, task, is_new){
    var values=gantt.getLightboxValues(); 
    console.log(values);
    console.log("Parent: "+values.parent);
    console.log("Start Date: "+values.start_date);
    console.log("New Task? "+is_new);
    console.log("Task: "+JSON.stringify(task));
    if(is_new){
    	addrecord(); 
    }
    else {
    	editrecord(); 
    }
    return true;
})
*/
gantt.attachEvent("onTaskSelected", function(id,item){
	console.log(id,item); 

    //any custom logic here
});
	
	 
	function is_selected_column (column_date){
	    if(selected_column && column_date.valueOf() == selected_column.valueOf()){
	        return true;
	    }
	    return false;
	}
	</script>
	<style type="text/css">
		html, body{
			font-family: arial;
			height:100%;
			padding:0px;
			margin:0px;
			overflow: hidden;
		}
		.header{
			height: 50px;
			text-align: center;
			line-height: 50px;

		}
		.main-content{
			height: 600px;
			height: calc(100vh - 50px);
		}
	</style>

<body>
	<!--<div class="header">
		<input type="button" value="Show Lightbox" onclick="gantt.createTask()"/>
		<input type="button" value="Show Quick Info" onclick="gantt.showQuickInfo(gantt.getTaskByTime()[0].id)"/>
		<input type="button" value="Show message" onclick="gantt.message({text:'Some text'})"/>
		<input type="button" value="Show error" onclick="gantt.message({text:'Some text', type:'error'})"/>
		<input type="button" value="Show alert" onclick="gantt.alert({text:'Some text'})"/>
		<input type="button" value="Show alert with header" onclick="gantt.alert({text:'Some text', title:'Title'})"/>
	</div>-->
	<div class="main-content">
		<div id="gantt_here" style='width:100%; height:100%;'></div>
	</div>
	<script type="text/javascript">
		gantt.config.scale_unit= "week";
		gantt.config.start_date = new Date(2015, 06, 16);
		gantt.config.end_date = new Date(2015, 11, 05);
		gantt.init("gantt_here");
		//gantt.message({text:"Some text", expire:-1});
		//gantt.message({text:"Some text", type:"error", expire:-1});
		//gantt.parse(projects_with_milestones);
		for(var i=0; i<projArray.length; i++){
			//console.log("original date: "+ projArray[i].projStart); 
			var date = new Date(parseInt(projArray[i].projStart));
			console.log("Bad Date = "+date, projArray[i].projStart, i);
			//console.log("modified date: " + date); 
			gantt.addTask({
		    id:projArray[i].projRID,
		    text:projArray[i].projName,
		    start_date:date
			});
			//console.log("PROJECT TASK ADDED",projArray[i].projRID);
			gettaskarray(projArray[i].projRID); 

		}
		

	</script>
<script>
function addrecord(){
	alert("Record Added"); 
}
function editrecord(){
	alert("Record Edited"); 
}


; 


</script>
</body>

<!--
function tasks(){
  this.taskID="string";
  this.taskName="string";
  this.taskStatus="string (Resource)";
  this.taskStartDate="StartDate";
  this.taskEndDate="EndDate";
  this.taskDuration=0;
  this.taskPercentComplete=0;
  this.taskPredID="Name";
}

var taskArray=[]; 

x.taskID=$(this).find("task_id").text();
x.taskName=$(this).find("task_name").text();
x.taskStatus=$(this).find("status").text();
x.taskStartDate=new Date(parseInt($(this).find("start").text()));
x.taskEndDate=new Date(parseInt($(this).find("projected_finish").text()));
x.taskDuration=10; 
x.taskPercentComplete=parseInt(($(this).find("___complete").text()*100));
x.taskPredID=$(this).find("predecessors").text();; /*$(this).find("predecessors").text();*/

